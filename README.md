# Psychedelic Experience

Stripped down source code of my Psychedelic Experience project (PEx). PEx was a comprehensive online resource surrounding psychedelic substances and plants.

This is the .NET backend published in a new repo without sensitive data, a git history rewrite was too much work unfortunately.
It was under development from 2015 to 2021, it stayed online until 2022...


Main features:
- Organisations and reviews: organisation diectory with review system for 800+ retreat centers, research organisations, clinics, individual practicioners, ...
- Organisation Events: Organisations could publish their events (retreats, community events, ...)
- Experiences: publish psychedelic experience reports online (not in ui anymomre)
- OAuth with fb and google integration, user profiles, notifications, syncrhronisation with external systems


Tech:
- .net core, asp.net, c#
- js/ts, react (with server-side rendering)
- Postgres/Marten document DB
- Clean Code/DDD/CQRS/Event Sourcing/Projections
- Behavior-driven Development
- Code generation based on a simple dsl for events, commands, value type, ... (*.gl) Generation tool is in the Tools folder.


Key takeaways:
- Sensitive data: don't put sensitive data (passwords, emails, api keys) in your git repositories. People are running scripts to extract it, even in the history. Also when it's a private, you never know who is watching ;-)
- Code: Seems I was in a hurry sometimes, some file names are wrong. Some files contain too many unrelated classes, or only comments. It's is a bit inconsistent, posted as is :-)
- MartinDB: I used the event projections to synchronize data with different external systems and to send emails. Projections can be monitored and rebuild via api (AdminController). It works in this case.
- CQRS: I created a view model per aggregate to query from the UI generated by a projection. I wouldn't start with this, querying the latest snapshot will do for a looong time in most cases.
- CQRS: Event sourcing, I always load the latest snapshot to apply commands to without loading the previous events. Storing the events and using the projections for view models, api calls and emails is still a huge benefit though.
- CQRS: Since the domain is very document centric, I was thinking a lot of the aggregates and command handlers could be developed in a more declarative way. Same for most controller actions. Maybe one day ;-)
